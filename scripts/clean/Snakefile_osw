
OSW_FILEDIR = "/hdd_14T/data/PXD002952/20210805_osw_run"

#rule compute:
#    input:
        #expand("results/concatenated_osw_results.csv"),
        #expand("results/mscore_threshold.csv"),
        #expand("results/osw_msstats_input.csv")

rule convert_osw_to_msstats:
    input:
        script = "convert_osw_to_msstats.py",
        input_file = "results/concatenated_osw_results.csv"
    params:
        #mscore_threshold = open("results/mscore_threshold.csv").read(),
        mscore_threshold = 0.00079,
        n_transitions = 6,
        min_peptides = 2,
        max_peptides = 10
    output:
        output = "results/osw_msstats_input.csv"
    shell:
        "python {input.script} \
            --input_file {input.input_file} \
            --output {output.output} \
            --m_score_threshold {params.mscore_threshold} \
            --n_transitions {params.n_transitions} \
            --min_peptides {params.min_peptides} \
            --max_peptides {params.max_peptides}"

rule compute_mscore4pepfdr:
    input:
        script = "mscore4pepfdr.r",
        input = "results/concatenated_osw_results.csv",
    params:    
        fft = "1",
        fdr_target = "0.01"
    output:
        output_file = "results/mscore_threshold.csv"
    shell:
        "Rscript {input.script} \
            -i {input.input} \
            -o {output.output_file} \
            --fft {params.fft} \
            --fdr_target {params.fdr_target}"
 
rule concatenate_osw:
    input:
        script = "concatenate_osw_results.py",
        file_directory = OSW_FILEDIR 
    output:
        output_file = "results/concatenated_osw_results.csv"
    shell:
        "python {input.script} \
            --file_directory {input.file_directory} \
            --output {output.output_file}"





